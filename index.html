<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ä°yi ki DoÄŸdun Ada!</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root { --pink: #d8a1b5; --pink-dark: #c48ca3; --bg: #fff6f9; --white: #ffffff; --text-color: #5d4037; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }
        body { 
            background: linear-gradient(135deg, #fff0f5 0%, #ffe4e1 100%);
            overflow-x: hidden; 
            color: var(--text-color); 
            position: relative;
        }

        /* GÄ°RÄ°Å EKRANI */
        #intro {
            height: 100vh; width: 100%; position: fixed; top: 0; left: 0;
            background: linear-gradient(135deg, var(--pink), var(--pink-dark));
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; text-align: center; color: white; padding: 20px;
        }
        .intro-title { font-size: 1.5rem; margin-bottom: 20px; font-weight: 300; }
        .countdown { display: flex; gap: 15px; margin-bottom: 40px; }
        .time-box {
            background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 15px;
            min-width: 80px; border: 1px solid rgba(255, 255, 255, 0.3); backdrop-filter: blur(5px);
        }
        .time-box span { display: block; font-size: 2rem; font-weight: 700; }
        #surpriseBtn {
            padding: 18px 45px; font-size: 1.2rem; border: none; border-radius: 50px;
            background: white; color: var(--pink-dark); cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); transition: 0.3s; font-weight: 600;
        }

        /* ANA Ä°Ã‡ERÄ°K */
        #content { display: none; padding-bottom: 100px; }
        .container { max-width: 800px; margin: auto; padding: 20px; }
        header { text-align: center; padding: 60px 0; }
        header h1 { font-size: 2.5rem; color: var(--pink-dark); text-shadow: 2px 2px 5px rgba(0,0,0,0.05); }
        section { margin-bottom: 80px; }
        h2 { text-align: center; color: var(--pink-dark); margin-bottom: 30px; font-size: 1.8rem; }

        .gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; }
        .gallery img { width: 100%; height: 250px; object-fit: cover; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.08); transition: transform 0.3s; }
        .gallery img:hover { transform: scale(1.02); }

        .note-card { background: white; padding: 40px; border-radius: 30px; box-shadow: 0 15px 40px rgba(0,0,0,0.05); text-align: center; border: 2px dashed var(--pink); }

        .cat-section { text-align: center; }
        #catImg { width: 220px; height: 220px; border-radius: 50%; box-shadow: 0 15px 35px rgba(0,0,0,0.15); object-fit: cover; }
        .jump { animation: jumpAnim 0.6s infinite alternate; }
        @keyframes jumpAnim { from { transform: translateY(0); } to { transform: translateY(-30px); } }
        #meowText { margin-top: 20px; font-size: 1.5rem; font-weight: 700; color: var(--pink-dark); display: none; }

        /* OYUN STILI */
        .game-container { background: white; padding: 30px; border-radius: 30px; box-shadow: 0 15px 40px rgba(0,0,0,0.08); max-width: 600px; margin: 0 auto; }
        #gameCanvas { border: 3px solid var(--pink); border-radius: 15px; display: block; margin: 20px auto; background: #fffafc; cursor: crosshair; width: 100%; max-width: 500px; }
        .game-info { display: flex; justify-content: space-around; margin-top: 20px; font-size: 1.2rem; font-weight: 600; color: var(--pink-dark); }
        #startGameBtn { padding: 15px 40px; font-size: 1.1rem; border: none; border-radius: 50px; background: var(--pink-dark); color: white; cursor: pointer; margin-top: 15px; transition: 0.3s; font-weight: 600; }
        #startGameBtn:hover { background: var(--pink); transform: scale(1.05); }
        .game-message { text-align: center; margin-top: 15px; font-size: 1.1rem; color: var(--pink-dark); font-weight: 600; min-height: 30px; }

        /* BLOCK BLAST OYUNU */
        #blockBlastCanvas { border: 3px solid var(--pink); border-radius: 15px; display: block; margin: 20px auto; background: #fdfdfd; cursor: pointer; width: 100%; max-width: 400px; box-shadow: inset 0 0 20px rgba(0,0,0,0.05); }
        .block-info { display: flex; justify-content: space-around; margin-top: 20px; font-size: 1.2rem; font-weight: 600; color: var(--pink-dark); }
        #startBlockBtn { padding: 15px 40px; font-size: 1.1rem; border: none; border-radius: 50px; background: var(--pink-dark); color: white; cursor: pointer; margin-top: 15px; transition: 0.3s; font-weight: 600; }
        #startBlockBtn:hover { background: var(--pink); transform: scale(1.05); }

        .music-btn { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; border-radius: 50%; background: var(--pink-dark); color: white; border: none; cursor: pointer; z-index: 2000; box-shadow: 0 5px 15px rgba(0,0,0,0.2); font-size: 1.2rem; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="intro">
        <h3 class="intro-title" id="baslik">Ada'nÄ±n 20. YaÅŸÄ±na Kalan Zaman:</h3>
        <div class="countdown">
            <div class="time-box"><span id="days">00</span>GÃ¼n</div>
            <div class="time-box"><span id="hours">00</span>Saat</div>
            <div class="time-box"><span id="minutes">00</span>Dakika</div>
        </div>
        <button id="surpriseBtn">SÃ¼rprizi AÃ§ âœ¨</button>
        <p id="uyari" style="margin-top:20px; opacity:0.8; font-size:0.9rem;">SÃ¼re dolmadan kilit aÃ§Ä±lmaz! ğŸ”’</p>
    </div>

    <div id="content">
        <div class="container">
            <header><h1>Ä°yi ki DoÄŸdun Ada! âœ¨<br>ArtÄ±k 20 Oldun!</h1></header>
            <section>
                <h2>AnÄ±larÄ±mÄ±z</h2>
                <div class="gallery">
                    <img src="2.jpeg" alt="AnÄ± 1"><img src="1.jpeg" alt="AnÄ± 2"><img src="5.jpeg" alt="AnÄ± 3">
                    <img src="3.jpeg" alt="AnÄ± 4"><img src="6.jpeg" alt="AnÄ± 5"><img src="4.jpeg" alt="AnÄ± 6">
                </div>
            </section>
            <section>
                <h2>Sana KÃ¼Ã§Ã¼k Bir Not</h2>
                <div class="note-card">
                    DoÄŸum gÃ¼nÃ¼ kutlu olsun, iyi ki seninle tanÄ±ÅŸmÄ±ÅŸÄ±m. Tekrar doÄŸsam seninle tekrar tanÄ±ÅŸmak isterdim, seni Ã§ok seviyom. 
                </div>
            </section>
            <section>
                <h2>DoÄŸduÄŸun Gecenin YÄ±ldÄ±zlarÄ± âœ¨</h2>
                <div class="note-card" style="background: linear-gradient(135deg, #5c2b3b 0%, #884d68 100%); color: white; padding: 30px 20px;">
                    <p style="margin-bottom: 20px; font-size: 1.1rem; opacity: 0.9;">
                        29 Ocak 2006, saat 00:00<br>
                        DÃ¼nyaya geldiÄŸin an, gÃ¶kyÃ¼zÃ¼ bÃ¶yleydi...
                    </p>
                    <canvas id="starMap" width="600" height="400" style="width: 100%; border-radius: 15px; background: radial-gradient(circle at bottom, #4a2030 0%, #2e101b 100%); box-shadow: 0 10px 20px rgba(0,0,0,0.3);"></canvas>
                    <p style="margin-top: 25px; font-style: italic; opacity: 0.8; font-size: 0.95rem;">
                        "O gece yÄ±ldÄ±zlar senin iÃ§in parladÄ±, ve hala parlÄ±yor..." ğŸ’«
                    </p>
                </div>
            </section>

            <section>
                <h2>tatlÄ± toplamaca ğŸ§</h2>
                <div class="game-container">
                    <p style="text-align: center; margin-bottom: 15px;">DÃ¼ÅŸen cupcake'leri topla, bombalarÄ± sakÄ±n! Her cupcake = 10 puan! ğŸ‚</p>
                    <canvas id="gameCanvas" width="500" height="400"></canvas>
                    <div class="game-info">
                        <div>Skor: <span id="score">0</span></div>
                        <div>SÃ¼re: <span id="timer">30</span>s</div>
                    </div>
                    <div style="text-align: center;">
                        <button id="startGameBtn">Oyunu BaÅŸlat! ğŸ®</button>
                    </div>
                    <div class="game-message" id="gameMessage"></div>
                </div>
            </section>

            <section>
                <h2>block patlatmaca</h2>
                <div class="game-container">
                    <p style="text-align: center; margin-bottom: 15px;">BloklarÄ± yerleÅŸtir, satÄ±rlarÄ± ve sÃ¼tunlarÄ± tamamla!</p>
                    <canvas id="blockBlastCanvas" width="400" height="550"></canvas>
                    <div class="block-info">
                        <div>Skor: <span id="blockScore">0</span></div>
                    </div>
                    <div style="text-align: center;">
                        <button id="startBlockBtn">Yeni Oyun ğŸ®</button>
                    </div>
                    <div class="game-message" id="blockMessage"></div>
                </div>
            </section>

            <section class="cat-section">
                <h2>TÄ±kla!</h2>
                <div id="catTrigger" style="cursor:pointer; display:inline-block;">
                    <img id="catImg" src="122.png" alt="Kedi">
                    <div id="meowText">Seni seviyorum!! â¤ï¸</div>
                </div>
            </section>
        </div>
    </div>

    <audio id="birthdayMusic" loop><source src="mÃ¼zik.mp3" type="audio/mpeg"></audio>
    <button class="music-btn" id="musicToggle">â–¶</button>

    <script>
        // TARÄ°H KONTROLÃœ
        const birthdayDate = new Date("January 29, 2026 01:00:00").getTime();
        let kilitAcik = true; // Test iÃ§in bunu 'true' yapabilirsin

        const timer = setInterval(function() {
            const now = new Date().getTime();
            const distance = birthdayDate - now;
            const d = Math.floor(distance / (1000 * 60 * 60 * 24));
            const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));

            document.getElementById("days").innerText = d > 0 ? d : 0;
            document.getElementById("hours").innerText = h > 0 ? h : 0;
            document.getElementById("minutes").innerText = m > 0 ? m : 0;

            if (distance <= 0) {
                clearInterval(timer);
                kilitAcik = true;
                document.getElementById("baslik").innerText = "BugÃ¼n BÃ¼yÃ¼k GÃ¼n! ğŸ‰";
                document.getElementById("uyari").innerText = "SÃ¼rpriz hazÄ±r! TÄ±kla!";
            }
        }, 1000);

        document.getElementById('surpriseBtn').onclick = function() {
            if (!kilitAcik) {
                alert("HenÃ¼z zamanÄ± gelmedi Ada! Biraz daha sabretmelisin. ğŸ˜Š");
                return;
            }
            document.getElementById('intro').style.display = 'none';
            document.getElementById('content').style.display = 'block';
            
            // YÄ±ldÄ±z haritasÄ±nÄ± iÃ§erik aÃ§Ä±ldÄ±ÄŸÄ±nda Ã§iz
            setTimeout(drawStarMap, 100); 

            try {
                document.getElementById('birthdayMusic').play();
            } catch(e) { console.log("Otomatik oynatma tarayÄ±cÄ± tarafÄ±ndan engellendi"); }
            
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        };

        // KEDÄ° EFEKTÄ°
        const catImg = document.getElementById('catImg');
        document.getElementById('catTrigger').onclick = function() {
            catImg.classList.toggle('jump');
            document.getElementById('meowText').style.display = 'block';
            setTimeout(() => { catImg.classList.remove('jump'); document.getElementById('meowText').style.display = 'none'; }, 3000);
        };

        // MÃœZÄ°K BUTONU
        let isPlaying = false;
        document.getElementById('musicToggle').onclick = function() {
            const music = document.getElementById('birthdayMusic');
            if (isPlaying) { music.pause(); this.innerText = 'â–¶'; } 
            else { music.play(); this.innerText = '||'; }
            isPlaying = !isPlaying;
        };

        // ---------------------------------------------------------
        // YENÄ° YILDIZ HARÄ°TASI (CANVAS Ä°Ã‡Ä°NDE)
        // ---------------------------------------------------------
        function drawStarMap() {
            const canvas = document.getElementById('starMap');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // Arka planÄ± temizle
            ctx.clearRect(0, 0, width, height);

            const centerX = width / 2;
            const centerY = height / 2;

            // Kova Burcu (Aquarius) Ã‡izimi - Pembe/Beyaz tonlarda
            const aquariusStars = [
                {x: centerX + 20, y: centerY - 60, name: 'Sadalmelik'},
                {x: centerX - 30, y: centerY - 70, name: 'Sadalsuud'},
                {x: centerX, y: centerY - 40, name: 'Eta Aquarii'}, // Merkez
                {x: centerX - 10, y: centerY - 10, name: 'Ancha'},
                {x: centerX + 30, y: centerY + 10, name: 'Skat'},
                {x: centerX + 60, y: centerY + 40, name: 'Albali'}
            ];

            // Ã‡izgileri Ã§iz
            ctx.beginPath();
            ctx.strokeStyle = 'rgba(255, 192, 203, 0.4)';
            ctx.lineWidth = 1.5;
            // Basit bir baÄŸlantÄ±
            ctx.moveTo(aquariusStars[1].x, aquariusStars[1].y);
            ctx.lineTo(aquariusStars[2].x, aquariusStars[2].y);
            ctx.lineTo(aquariusStars[0].x, aquariusStars[0].y);
            ctx.moveTo(aquariusStars[2].x, aquariusStars[2].y);
            ctx.lineTo(aquariusStars[3].x, aquariusStars[3].y);
            ctx.lineTo(aquariusStars[4].x, aquariusStars[4].y);
            ctx.stroke();

            // BurÃ§ YÄ±ldÄ±zlarÄ±nÄ± Ã§iz
            aquariusStars.forEach(star => {
                ctx.beginPath();
                ctx.fillStyle = '#fff';
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#ff69b4';
                ctx.arc(star.x, star.y, 4, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            });

            // Rastgele Arka Plan YÄ±ldÄ±zlarÄ±
            for(let i=0; i<150; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const size = Math.random() * 2;
                const opacity = Math.random();
                
                ctx.beginPath();
                ctx.fillStyle = `rgba(255, 220, 230, ${opacity})`;
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }

            // Metin
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.font = '14px Poppins';
            ctx.textAlign = 'center';
            ctx.fillText("Kova TakÄ±myÄ±ldÄ±zÄ±", centerX, centerY + 80);
        }


        // ---------------------------------------------------------
        // CUPCAKE OYUNU
        // ---------------------------------------------------------
        const gameCanvas = document.getElementById('gameCanvas');
        const gameCtx = gameCanvas.getContext('2d');
        let gameRunning = false;
        let score = 0;
        let timeLeft = 30;
        let basketX = 225;
        let fallingItems = [];
        let gameInterval, spawnInterval;

        class FallingItem {
            constructor() {
                this.x = Math.random() * (gameCanvas.width - 40);
                this.y = -40;
                this.speed = Math.random() * 2 + 2;
                this.isBomb = Math.random() < 0.25; 
                this.emoji = this.isBomb ? 'ğŸ’£' : ['ğŸ§', 'ğŸ‚', 'ğŸ°', 'ğŸª'][Math.floor(Math.random() * 4)];
            }
            update() { this.y += this.speed; }
            draw() { gameCtx.font = '35px Arial'; gameCtx.fillText(this.emoji, this.x, this.y); }
            checkCollision(bx) {
                return this.y > gameCanvas.height - 60 && this.y < gameCanvas.height - 10 &&
                       this.x > bx - 20 && this.x < bx + 70;
            }
        }

        function gameLoop() {
            if (!gameRunning) return;
            gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
            
            // Sepet
            gameCtx.fillStyle = '#ff69b4';
            gameCtx.fillRect(basketX, gameCanvas.height - 50, 50, 40);
            gameCtx.fillStyle = '#ff85cc';
            gameCtx.fillRect(basketX - 10, gameCanvas.height - 50, 70, 10);

            for(let i = fallingItems.length - 1; i >= 0; i--) {
                let item = fallingItems[i];
                item.update();
                item.draw();
                
                if (item.checkCollision(basketX)) {
                    if (item.isBomb) {
                        score = Math.max(0, score - 20);
                        showGameMsg('ğŸ’¥ -20 puan!');
                    } else {
                        score += 10;
                        showGameMsg('ğŸ‰ +10 puan!');
                    }
                    fallingItems.splice(i, 1);
                } else if (item.y > gameCanvas.height) {
                    fallingItems.splice(i, 1);
                }
            }
            document.getElementById('score').textContent = score;
            requestAnimationFrame(gameLoop);
        }

        function showGameMsg(text) {
            const msg = document.getElementById('gameMessage');
            msg.textContent = text;
            setTimeout(() => msg.textContent = '', 800);
        }

        function startGame() {
            gameRunning = true; score = 0; timeLeft = 30; fallingItems = [];
            document.getElementById('score').textContent = '0';
            document.getElementById('startGameBtn').disabled = true;
            
            gameInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;
                if (timeLeft <= 0) endGame();
            }, 1000);

            spawnInterval = setInterval(() => {
                if(gameRunning) fallingItems.push(new FallingItem());
            }, 800);
            gameLoop();
        }

        function endGame() {
            gameRunning = false;
            clearInterval(gameInterval); clearInterval(spawnInterval);
            document.getElementById('startGameBtn').disabled = false;
            let msg = score >= 100 ? "HarikasÄ±n!" : "Ä°yi deneme!";
            document.getElementById('gameMessage').textContent = `Oyun Bitti! ${msg} Skor: ${score}`;
        }

        // Mouse/Touch Kontrol
        function moveBasket(clientX) {
            const rect = gameCanvas.getBoundingClientRect();
            let x = clientX - rect.left - 25;
            basketX = Math.max(0, Math.min(x, gameCanvas.width - 50));
        }
        gameCanvas.addEventListener('mousemove', e => moveBasket(e.clientX));
        gameCanvas.addEventListener('touchmove', e => { e.preventDefault(); moveBasket(e.touches[0].clientX); });
        document.getElementById('startGameBtn').addEventListener('click', startGame);

        // ---------------------------------------------------------
        // GÃœNCELLENMÄ°Å BLOCK BLAST OYUNU (Hitbox DÃ¼zeltildi)
        // ---------------------------------------------------------
        const blockCanvas = document.getElementById('blockBlastCanvas');
        const blockCtx = blockCanvas.getContext('2d');
        const gridSize = 8;
        const cellSize = 40;
        const gridOffsetX = 40; // IzgarayÄ± ortalamak iÃ§in
        const gridOffsetY = 100;
        
        let blockGrid = Array(gridSize).fill(null).map(() => Array(gridSize).fill(0));
        let blockScore = 0;
        let currentPiece = null;
        let nextPieces = [];
        let isDragging = false;
        let dragStartPos = {x:0, y:0}; // ParÃ§anÄ±n neresinden tuttuÄŸumuz

        const blockShapes = [
            [[1]], [[1,1]], [[1],[1]], [[1,1],[1,1]], 
            [[1,1,1]], [[1],[1],[1]], [[1,0],[1,1]], 
            [[1,1,1],[1,0,0]], [[1,1,1],[0,0,1]]
        ];

        function initBlockGame() {
            blockGrid = Array(gridSize).fill(null).map(() => Array(gridSize).fill(0));
            blockScore = 0;
            document.getElementById('blockScore').textContent = '0';
            generateNextPieces();
            drawBlockGame();
        }

        function generateNextPieces() {
            nextPieces = [];
            const colors = ['#ff69b4', '#ff85cc', '#9370db', '#ff1493', '#db7093'];
            for (let i = 0; i < 3; i++) {
                const shape = blockShapes[Math.floor(Math.random() * blockShapes.length)];
                // ParÃ§alarÄ± yan yana diz (Canvas geniÅŸliÄŸi 400)
                nextPieces.push({
                    shape: shape,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    x: 30 + i * 110, // AralÄ±klÄ± yerleÅŸim
                    y: 30,
                    scale: 25 // AÅŸaÄŸÄ±daki Ã¶nizleme boyutu
                });
            }
        }

        function drawBlockGame() {
            blockCtx.clearRect(0, 0, blockCanvas.width, blockCanvas.height);

            // 1. Grid Ã‡izimi
            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    const x = c * cellSize + gridOffsetX;
                    const y = r * cellSize + gridOffsetY;
                    
                    if (blockGrid[r][c]) {
                        blockCtx.fillStyle = blockGrid[r][c];
                        blockCtx.fillRect(x, y, cellSize-2, cellSize-2);
                        // Parlama efekti
                        blockCtx.strokeStyle = "rgba(255,255,255,0.5)";
                        blockCtx.strokeRect(x, y, cellSize-2, cellSize-2);
                    } else {
                        blockCtx.strokeStyle = '#e0e0e0';
                        blockCtx.strokeRect(x, y, cellSize-2, cellSize-2);
                    }
                }
            }

            // 2. Alt KÄ±sÄ±mdaki ParÃ§alar
            nextPieces.forEach(p => {
                if(p) drawPiece(p.shape, p.x, p.y, p.color, p.scale);
            });

            // 3. SÃ¼rÃ¼klenen ParÃ§a (En Ã¼stte Ã§izilmeli)
            if (currentPiece && isDragging) {
                // SÃ¼rÃ¼klerken boyut orijinal Ä±zgara boyutu (40px) olsun
                // Mouse'un biraz yukarÄ±sÄ±nda Ã§iz (offset) ki parmak/mouse kapatmasÄ±n
                drawPiece(currentPiece.shape, currentPiece.x, currentPiece.y, currentPiece.color, cellSize);
            }
        }

        function drawPiece(shape, x, y, color, size) {
            blockCtx.fillStyle = color;
            blockCtx.strokeStyle = 'white';
            shape.forEach((row, i) => {
                row.forEach((val, j) => {
                    if (val) {
                        blockCtx.fillRect(x + j * size, y + i * size, size-2, size-2);
                        blockCtx.strokeRect(x + j * size, y + i * size, size-2, size-2);
                    }
                });
            });
        }

        // MOUSE EVENTS (Hitbox DÃ¼zeltilmiÅŸ)
        blockCanvas.addEventListener('mousedown', e => handleInputStart(e));
        blockCanvas.addEventListener('mousemove', e => handleInputMove(e));
        blockCanvas.addEventListener('mouseup', e => handleInputEnd(e));
        
        // TOUCH EVENTS
        blockCanvas.addEventListener('touchstart', e => {
            e.preventDefault(); 
            handleInputStart(e.touches[0]);
        });
        blockCanvas.addEventListener('touchmove', e => {
            e.preventDefault();
            handleInputMove(e.touches[0]);
        });
        blockCanvas.addEventListener('touchend', e => {
            e.preventDefault();
            handleInputEnd(e.changedTouches[0]);
        });

        function getMousePos(evt) {
            const rect = blockCanvas.getBoundingClientRect();
            return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
            };
        }

        function handleInputStart(evt) {
            const pos = getMousePos(evt);
            
            // Hangi parÃ§aya tÄ±klandÄ±?
            for(let i=0; i<nextPieces.length; i++) {
                const p = nextPieces[i];
                if(!p) continue;
                
                // Basit bounding box kontrolÃ¼ (scale 25px Ã¼zerinden)
                const pWidth = p.shape[0].length * p.scale;
                const pHeight = p.shape.length * p.scale;
                
                // Hitbox'Ä± biraz geniÅŸletelim ki mobilde kolay seÃ§ilsin (+10px padding)
                if (pos.x >= p.x - 10 && pos.x <= p.x + pWidth + 10 &&
                    pos.y >= p.y - 10 && pos.y <= p.y + pHeight + 10) {
                    
                    // SeÃ§ilen parÃ§ayÄ± kopyala
                    currentPiece = { ...p, originalIndex: i };
                    
                    // TÄ±kladÄ±ÄŸÄ±mÄ±z yer ile parÃ§anÄ±n sol Ã¼st kÃ¶ÅŸesi arasÄ±ndaki fark
                    dragStartPos.x = pos.x - p.x;
                    dragStartPos.y = pos.y - p.y;
                    
                    // ParÃ§ayÄ± hemen mouse'un ortasÄ±na oturt (daha doÄŸal his)
                    const actualWidth = p.shape[0].length * cellSize;
                    const actualHeight = p.shape.length * cellSize;
                    
                    // SÃ¼rÃ¼klemeye baÅŸlarken parÃ§ayÄ± ortala
                    currentPiece.x = pos.x - (actualWidth / 2);
                    currentPiece.y = pos.y - (actualHeight / 2) - 30; // Hafif yukarÄ±da tut
                    
                    isDragging = true;
                    drawBlockGame();
                    break;
                }
            }
        }

        function handleInputMove(evt) {
            if (!isDragging || !currentPiece) return;
            const pos = getMousePos(evt);
            
            // ParÃ§anÄ±n sol Ã¼st kÃ¶ÅŸesini gÃ¼ncelle
            // Mouse'un tam altÄ±nda deÄŸil, biraz yukarÄ±sÄ±nda olsun (-30px)
            const actualWidth = currentPiece.shape[0].length * cellSize;
            const actualHeight = currentPiece.shape.length * cellSize;
            
            currentPiece.x = pos.x - (actualWidth / 2);
            currentPiece.y = pos.y - (actualHeight / 2) - 30;
            
            drawBlockGame();
        }

        function handleInputEnd(evt) {
            if (!isDragging || !currentPiece) return;
            
            // BÄ±rakÄ±lan yer Ä±zgaraya denk geliyor mu?
            // ParÃ§anÄ±n MERKEZÄ°NÄ° referans alalÄ±m
            const centerX = currentPiece.x + (currentPiece.shape[0].length * cellSize) / 2;
            const centerY = currentPiece.y + (currentPiece.shape.length * cellSize) / 2;
            
            // Grid koordinatlarÄ±na Ã§evir
            const col = Math.floor((currentPiece.x - gridOffsetX + (cellSize/2)) / cellSize);
            const row = Math.floor((currentPiece.y - gridOffsetY + (cellSize/2)) / cellSize);

            if (canPlace(currentPiece.shape, row, col)) {
                placeShape(currentPiece.shape, row, col, currentPiece.color);
                checkLines();
                
                // AÅŸaÄŸÄ±daki listeden parÃ§ayÄ± sil
                nextPieces[currentPiece.originalIndex] = null;
                
                // Hepsi bitti mi?
                if (nextPieces.every(p => p === null)) generateNextPieces();
            }

            isDragging = false;
            currentPiece = null;
            drawBlockGame();
        }

        function canPlace(shape, r, c) {
            for (let i = 0; i < shape.length; i++) {
                for (let j = 0; j < shape[i].length; j++) {
                    if (shape[i][j]) {
                        let nr = r + i;
                        let nc = c + j;
                        // SÄ±nÄ±r dÄ±ÅŸÄ± veya dolu mu?
                        if (nr < 0 || nr >= gridSize || nc < 0 || nc >= gridSize || blockGrid[nr][nc]) {
                            return false;
                        }
                    }
                }
            }
            return true;
        }

        function placeShape(shape, r, c, color) {
            shape.forEach((row, i) => {
                row.forEach((val, j) => {
                    if (val) blockGrid[r + i][c + j] = color;
                });
            });
            blockScore += 10;
            document.getElementById('blockScore').textContent = blockScore;
        }

        function checkLines() {
            let linesCleared = 0;
            
            // SatÄ±r kontrol
            for (let r = 0; r < gridSize; r++) {
                if (blockGrid[r].every(v => v !== 0)) {
                    blockGrid[r].fill(0);
                    linesCleared++;
                }
            }
            
            // SÃ¼tun kontrol (biraz daha karmaÅŸÄ±k, geÃ§ici matris kullanmadan)
            // SÃ¼tunlarÄ± temizlemek iÃ§in Ã¶nce hangi sÃ¼tunlarÄ±n dolu olduÄŸunu bul
            let colsToClear = [];
            for (let c = 0; c < gridSize; c++) {
                let isFull = true;
                for (let r = 0; r < gridSize; r++) {
                    if (blockGrid[r][c] === 0) { isFull = false; break; }
                }
                if (isFull) colsToClear.push(c);
            }
            
            colsToClear.forEach(c => {
                for(let r=0; r<gridSize; r++) blockGrid[r][c] = 0;
                linesCleared++;
            });

            if (linesCleared > 0) {
                blockScore += linesCleared * 50;
                document.getElementById('blockScore').textContent = blockScore;
                const msg = document.getElementById('blockMessage');
                msg.textContent = `Harika! ${linesCleared} hat temizlendi!`;
                setTimeout(() => msg.textContent = '', 1500);
            }
        }

        document.getElementById('startBlockBtn').onclick = initBlockGame;

    </script>
</body>
</html>
